<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<title>Neuro experiment 2 - Neural simulation</title>
<style>
body {background-color: black;}

html *
{
	font-size: 1em;
	color: lightgray;
	font-family: Arial;
}

.float-left-child {
	float: left;
}

/* base css */
body {
	padding: 0px;
}
.parent {
	padding: 0px
}
.child {
	padding: 5px
}

.button {
	background-color: #303030;
	width: 150px;
	border: solid 2px lightgray;
	color: lightgray;
	padding: 5px 3px;
	text-align: center;
	text-decoration: none;
	display: inline-block;
	margin: 4px 2px;
	cursor: pointer;
}

.button1 {font-size: 16px;}

</style>
</head>

<body>

<script src="../drawing.js"></script>
<script src="../vec2.js"></script>
<script src="../intersections.js"></script>
<script src="../random.js"></script>
<script src="../mouse.js"></script>
<script src="../neurallayer.js"></script>
<script src="../neuralnet.js"></script>
<script src="worldmodel.js"></script>
<script src="visualizer.js"></script>
<script src="pilotnet.js"></script>
<script src="neuralpilot.js"></script>

<div class='parent'>
	<div class='child float-left-child'>
		<canvas id="canvas" width="800" height="800" style="border:0px;">Your browser does not support the HTML5 canvas tag.</canvas>
	</div>
	<div class='child float-left-child'>
		<div class='parent'>
			<div class='child float-left-child'>
				<button class="button button1" onclick="onPauseButton()">Toggle pause</button><br>
				<p id="PAUSE_STATUS">Pause OFF</p>
				<hr>
				<button class="button button1" onclick="onRandomizePosButton()">Randomize pos.</button><br>
				<button class="button button1" onclick="onSetPosButton()">Set pos.</button><br>
				<label for="ID_POS_X" title="x position">x</label> <input type="number" id="ID_POS_X" value=0><br>
				<label for="ID_POS_Y" title="y position">y</label> <input type="number" id="ID_POS_Y" value=-300><br>
				<hr>
				Network setup:<br>
				<textarea id="ID_NET_SETUP" rows="5" cols="30">{"nnet":"[{\"nInputs\":16,\"nNeurons\":16,\"weights\":[18.035514618563337,21.997696540054992,6.711069485972128,39.37445028283981,-1.2913797940527088,-58.450682095138994,-22.04661424326692,-11.803603757951254,6.733599010185552,1.4368851984981408,6.6049579712214825,-19.587676646806546,-52.84395943206392,-3.2776080787691395,-9.10660828428406,-19.74854223387129,0.8142957460023532,-16.69815101211953,-19.524068363814983,-5.5859472610533745,-14.094649081728477,31.39564353509401,-2.3523575909852656,-22.492244788397684,-25.22747649572641,-7.240963837267309,-46.285372231521876,-44.71356713748948,-28.797731417317905,28.395242704663957,-30.998693228655757,14.154716274755454,-8.568017959539654,52.2996619088754,12.66064986201582,-19.464713789631883,10.633001071682926,-1.025609272028929,-15.870412479292275,-38.62777401633223,57.11012972995584,-32.10542574182813,38.935337913664334,36.25033434988902,-13.072682322257824,-36.0628271609771,-2.0391424702320005,15.356123155703527,-22.342264063670626,2.0389404817264807,-18.44442646324344,-9.377171726635286,-47.25764817657932,16.057799993260947,24.533664427609448,51.909965217299614,14.61220647024994,26.720540034612416,3.347579883274143,-22.599150197913918,-20.096765591038356,32.02983947527307,-6.387615253999097,24.091201201574933,-4.0986083210797295,25.34049667043526,10.91162020125887,10.66969157374915,-23.983377131686083,-36.681199914229,-51.984077909936225,-27.866671691382127,-25.228593979654747,3.6950719400875682,18.684767121932477,21.34085402674444,26.172520541043383,5.3689507100192415,2.8046764461308444,21.49319793280105,-6.815071369595229,24.253120378049925,-19.825681133351864,-55.42840652576752,-41.90250063355672,-27.288324617357524,-22.86996376088329,-45.25060548642639,35.02683130805506,-1.1690744938647146,6.5355631953669535,-56.008796697944646,0.03771258277537162,25.03089553274792,9.904121139378226,-14.050474019282408,-37.33035900768242,18.6456014406265,-29.557212704006954,18.422638518721214,17.80616057343303,-40.83124198470577,-28.81968680792403,-14.145475818752708,-15.254187019146626,13.769031511686897,8.852080675304775,-15.024547002801866,18.850401455190106,14.036113607848026,24.304435383669496,15.340898196267304,5.243637678332129,-3.25082909461538,-4.917483143985738,47.3402953098258,10.419749061534397,-20.546120003228744,5.667806112240017,-30.159932842393577,-21.481574720091693,6.402706801581595,26.861420562516642,-6.07096991772869,-37.63079381682335,15.550009077002949,-44.144237521472455,23.02380545007199,30.25698217105432,-19.668505334343735,9.792822259984886,7.846511932525866,4.627359853655808,-37.5559813462921,25.216725330404252,19.868066974860653,-50.5168532430257,10.660650013556978,26.955965472190524,55.359450939418856,26.394803875859402,-52.555462575497515,14.372307926959147,-37.56553287575438,-36.1317854531839,19.89040384556042,13.27273189109018,-7.983786822174711,-36.23224165652004,31.40587365039469,0.6956159263213048,-2.739258507328631,-11.395132273276326,3.3179773850492507,-4.885125928262549,4.282590962966401,-37.451248591420075,11.439731535586601,24.892671445670267,-5.09683212459099,17.187036100510856,-60.254853689551126,35.326469448667275,-33.77663607595773,28.234739827450273,13.389895160847711,-3.2955941810828473,20.952241558878296,3.169513410070962,-6.705129877089677,12.219509233782372,17.985010013161542,4.129226346684494,-5.975526147547445,-15.143189648074467,-11.505073770780061,-7.1603582735729,-14.871639159908586,-18.521991257247045,33.08577839289498,36.03943430622735,21.0620514641321,39.20101370196919,9.065354272190891,38.27443128350566,46.172848248320136,6.238501956326103,-16.768878711756475,47.72934096624632,29.29438186056844,3.5143281971696445,38.475515167806684,-5.057845131016462,7.943794670242172,-9.340826884116366,2.2001433050034542,-31.052844929080198,-11.324539303994841,15.0857270265249,0.27266599535294656,9.028955082951086,-21.597637533776762,-33.58635785118753,17.1419990660412,-24.432507167725568,-12.214769029700385,-11.979784290911203,-43.79668297841202,-3.528322618677526,51.793294997968395,-34.148966539216694,-22.13954926728112,-6.043331085110946,-36.262301229563896,-20.625391238429696,-46.0960873799441,43.21680191555625,13.538710916500676,5.340515995001951,-17.867044728919403,-20.13183697439082,18.684513558428776,-53.610319149702946,11.108435921908974,-13.140231928451977,11.358264822735663,-13.1418125705004,2.2466952077314333,18.923884484607775,4.762726890172611,28.694567480818087,37.39054679101487,22.379421852401407,43.568263263457496,-31.889303676563742,52.394234793754094,10.377382319277963,-70.06291554138797,14.039729350612427,16.019858930839142,5.749572476671433,-26.64996473976422,28.774704878747645,-28.074898352025432,8.563634358221975,-37.298113694647164,-41.012966977034935,42.075610753081946,40.47872557836212,-0.7308157518925029,-10.513074922293018,-29.462185623529475,-14.680430263391266,16.015928343523733,-33.1059961411458,-3.7548566908312404,-1.355449374127186,-18.640937172665566,-9.145578804112391,-25.18219402661328,6.643199657253725,5.125164742434188,45.31130370979849,18.215356073337656,-5.558535795632369,52.90750255432368,-25.355283417389696,4.517549682799697,28.35211547182215,40.62732193239085,-55.752311458697115,27.26728282841756],\"outputs\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{\"nInputs\":16,\"nNeurons\":16,\"weights\":[-1.3845056112247656,-9.096043708572253,-2.9437175980430785,15.072122158227788,-10.52056333279466,27.71989484067165,-3.6901923724673167,43.79434221099381,-14.320259998360198,-8.790347504239055,-24.80480408406389,-11.709338966132231,-28.6942647859471,13.982292056243672,-1.9635605850479225,1.107180439789905,-0.9797017657116357,-26.964841020960215,14.086149769141374,3.983081190025419,-3.4234147755808673,18.916653512782375,-6.049664376550731,7.192956187429863,-7.315373705072427,-46.117472177250995,39.57906994285549,-14.129948814093378,16.562898461163822,24.262867467645332,-20.582341855028098,22.339134004898447,-30.002478992362203,12.058966261526889,24.872473046302662,-5.1979239373089055,29.64160788891754,21.45068651018544,18.93072983924181,-2.270935112794799,-16.880132531926893,-17.623004370725855,24.23689389419317,-12.926056375674998,-24.002569346371683,-24.462144858667763,-11.729610935943489,-3.482721837496335,17.31996149673287,-20.900247469095707,-22.778476019322092,-10.14077963608888,-22.38434758521722,28.658654869928252,27.79667190593518,19.195718228794224,4.606214095164804,26.243959267806115,-23.549976910402172,-20.460015121144497,-16.87928846925758,-39.71779655927898,-2.199771625120294,-34.082174497071534,-17.42898516326954,24.853833062876618,-3.528841787784387,-12.775656643259623,0.25756495971484783,0.921508172904047,7.261812667094883,-28.8088292202491,34.822405115012515,-25.288533076618993,18.949529193900588,-62.0981560623514,-20.39499730149588,-31.606125212386353,-39.43048106403261,28.34589409763848,-20.07475250197771,-26.430979721661576,-56.14303273548607,18.974048491532415,41.267446899702335,-0.7568104089694387,22.88531142053071,-22.301674885015224,-46.72241363501871,-3.933510434421181,-15.868105146191603,-9.109001633951676,-2.950363257221193,2.9780880158559313,37.11627917494618,20.13766460043544,5.9503794120954705,18.92789302917382,-10.298491793153978,11.423058206439547,-28.90176238224892,-36.336638784133626,2.2387647721929413,17.99224191116724,58.52521272432536,0.48728322404386026,-48.745897920534894,-18.92789810042676,-20.911470019991565,-13.257880871742683,8.00032002696022,2.049631078093844,25.333046899082436,43.61560562528075,-8.243855586114034,2.2217796307942197,-21.057267998516362,-37.16634309418267,9.381095045959302,12.897239204616664,22.129283293483986,-21.36938760993755,-22.681981070593295,-11.21193685699331,5.271140197884248,-5.426416676042442,-9.61617965545384,-37.221239056562524,-15.155539199301131,9.263807481789017,29.56083666907688,-7.362037263151126,18.54190728961586,0.23079999453105718,-2.3649076412850256,2.1089811872052087,17.72160066075906,-1.5494929057240636,15.072630933738218,3.7717401529058456,8.89848538636925,1.5599388284441702,32.26560902983043,0.8668565345971779,-17.013711304998345,11.46035746298027,-10.508801419911393,-19.78639671100103,26.812377984884,-13.456729338604218,16.178959441612328,-35.79975542836552,4.732661296164047,-10.038198305967098,33.67945622755304,-11.96046238257226,-22.19620764437456,-19.36413084511419,44.75693049996239,-30.642714670815916,-21.931564911756993,38.707099670280016,-8.344708422295492,-29.1558969222381,54.41772379371125,-54.929363940871646,-4.259196092151982,-13.151044707676842,-2.6641998328003402,21.44115835573218,0.21625865114116474,-1.977475596446235,-56.02748861395971,8.883801777414323,-11.734936180334374,16.89370447224308,14.258124549580828,12.9518783605794,29.636009080735313,-53.369880380411594,-2.91177817173975,-3.0645627735994805,8.31944521717258,11.890427331947059,-41.845258299623495,-14.076510606771299,5.527935473159923,6.681636380096935,-0.2988746262708679,38.63987748006759,-0.15216557872027642,44.375996365367094,-35.102731593035706,20.974933897842394,-5.842405573464361,-33.6507947482275,22.027341270851657,-25.249184709916612,33.430074499817806,20.8635542746225,-44.97866153914608,-16.949127675990557,14.441868569934801,6.767060054465504,13.827078497272971,-4.1410952041885825,-36.678393935706154,6.2904315912835775,-11.676879494947164,-9.313582468866421,-6.156266051050749,26.774074746341373,14.019292620729141,-7.78883101798807,10.550961223323085,-5.980352292099251,-7.736229897151396,54.10139078650467,13.98501566322579,-24.813349101987775,-14.45409264824229,4.8820181278784744,-41.69185011257965,40.72452704782584,-51.723078108048384,51.77591056049831,-11.573040504959083,5.655081207151497,-42.91805722061466,-10.355252448963558,5.415493545438064,22.47169684526083,-33.23277615925881,32.743299201038255,16.979486202753662,40.63708420032986,-30.634719379597204,-17.025815038844307,-36.5800602985933,-11.084021534923393,-0.8360495054694718,30.942880416056497,-30.366905176893553,18.201478215257378,-6.681202068408833,-26.57852337532959,-17.683086547723356,-19.751724483882,30.221441405017462,25.474605375627117,-18.54615327316027,13.15316965089041,-7.613830855861994,-14.024068240860188,48.64813243409865,-11.668756502586893,5.9215307887410065,-11.335848279445598,-14.668856839008958,5.698153411542821,12.66993614171517,-17.097095996408747,-23.94180663115607,-61.854624993704526,19.909555886696605,10.44764889346484,-32.641671067444065,-41.86151366481129,-20.928741215006596,25.700588740358512,-18.94970157364877,3.960857994699293],\"outputs\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{\"nInputs\":16,\"nNeurons\":16,\"weights\":[37.60385586639226,36.444975993388674,-35.81054865546067,-32.702288139653035,-1.827229379111339,7.123774451838422,-80.51892919483544,-2.4910163850153646,9.584293286855571,2.543703472417461,13.85139779339295,-25.02574999892159,-16.885666659487818,23.64702412680111,-15.086329626061461,4.788344298388466,-1.440729313376232,9.246677450184867,-11.098156573608973,35.74077737109685,-33.417764266670076,-3.716960772157198,24.395341988795483,35.72476419366369,-8.278441125181557,-2.1266254284917667,1.2713721519308177,27.024406290204286,-45.928867175973615,50.42892776819734,-1.2971497913553587,-31.5888569000437,34.67080432192098,1.8429541395368152,-13.57161259063192,20.80224254670708,-2.6481474611785507,-22.757978150023646,-1.4366491575859228,18.959005529355636,5.4291640043374265,-9.284626006883629,21.24133578967661,-2.4077354533034883,-11.764592071900145,5.472093394390997,38.625827260758605,-37.58938902501906,-45.88439546691414,-20.09087389871839,21.46829611119453,-6.804563039172705,29.98017508793576,14.243230305832281,6.447655466170373,-10.83611916491616,-0.6248421892691912,43.47922352792768,-6.420352157677029,-34.9778517315961,9.661913466738264,-27.910359880628373,-1.6522090516495578,-29.40017151321683,6.6479812276251184,26.925860095058496,-8.691018818148354,-14.59403890144453,67.71770979326871,-20.298266026946212,-44.39752527278248,-10.346872358429755,-20.2674422088029,-57.995569221478554,46.33082624567431,-2.868193788933562,-1.9443782489795833,-46.31979827175946,1.7044618866795953,19.899638983674432,-5.502699340282682,-16.21228271471374,-16.486932289530838,2.859215183848033,13.173440411475372,8.202728983839034,-25.874775967784235,-20.632791565921337,47.14631920924022,50.0538410310559,-15.254023954261715,5.818774366570699,37.42011199148973,-0.8058807092895196,41.94018484594442,-11.189276887553538,-10.31849855606661,28.34110763534349,-1.146964958138835,10.259650108625154,39.13179598409806,27.761784604347106,16.219411052253367,-29.01290855825056,25.346264562237195,29.81847265702121,46.04523618936686,-11.336183438297853,-11.155460573409135,21.66690332433629,-20.204900967713623,22.18997713979331,8.203415378838846,11.132998923007143,-19.52963257307471,10.452977808155845,11.602372134342371,7.3645708805654495,-23.709110255481214,-4.797215466395925,-39.20661680710662,-14.1074157956578,38.42218652603881,15.709506425983617,35.88683405295927,-10.560468397241706,-3.9028244673906753,-10.152281187297183,-50.8534202500659,-15.41563030309209,-34.159093617128015,-18.42297547270414,-8.68329299365315,0.45666004675492944,0.6275582748540038,-19.840888506647246,-13.642121506729712,-9.879681233007373,20.53741507362409,40.20431990771784,-20.322950818049975,-38.171252001716425,3.0937821454619487,25.825624155374356,2.8955248812735572,18.980251508573147,-27.370875856723572,20.468991245156186,-10.73016296383727,-27.256715085239463,6.409098329967751,21.830842035470948,30.840458473242727,-3.1291853391251383,33.2298019357599,-27.762211686169525,14.935054949240033,31.701703016231207,-33.96800203915703,-0.2782373153027994,-9.823702938525697,7.245142350543127,2.4488419784891153,-23.93043375650407,-37.76351240185436,19.543378127470906,-0.240446164916595,25.885396366547223,-4.36308594552592,17.300630086522165,-0.25647039759342893,23.676564558762706,33.62441389936477,4.156860693729214,-16.704210204346992,-5.10664553674393,26.548581986866434,46.06484102751259,-34.843811897893545,5.690777178510942,23.714393688359195,23.108108985244677,2.5707763270158415,-6.948524374945279,-11.180991711784257,9.67335327928294,14.218604223958632,18.081191034762053,-4.6659772286589245,-47.53085202263688,-24.837924131099335,-14.537616131196396,47.846158382487125,11.495343976217661,44.05908349238612,12.739590929830056,-20.054265241774676,11.819332583988883,24.667446868186882,22.561538960301625,-18.60160837252771,6.937377852212022,21.073912052767376,12.989670323263285,4.530770060106822,36.629447164647004,54.69292903568033,-31.194845251772943,-9.433354638249595,-7.473966608825884,-42.51291032938503,8.949954068402935,-18.406231169555067,23.203728885497505,5.648736070988988,70.82008879586094,-48.03114254771141,8.22115005912492,-20.919187269432047,-2.7386476109419484,33.7205425263962,21.2590542957141,-9.568401474143794,-25.743232541675702,-7.882543431983215,2.062792899568578,-13.099775509801795,13.42379913099292,-7.293433324477952,24.674755289070102,38.52229936426713,-1.5749900939123729,6.706620034270252,-3.3212413402596828,2.4551088472365055,-19.000205079909172,-41.19346650522865,-7.824485283441739,35.11975338099374,-33.27436383153323,-14.447298507866165,-55.24994261816021,3.422762405524378,11.231187058154948,3.619526610299504,-10.408233694845157,-32.06196923142395,22.814836662230718,-1.2467765371966344,-4.036737183304567,25.691500081998907,0.5649479930763398,40.17427558059268,23.23285848459808,-4.562913290736993,-5.028665348839844,-45.36536551009012,25.150110152738918,-38.856267359193744,-7.127781792716408,58.57942831987294,-7.070401082378019,-6.527797123640869,26.70497573741538,-2.6174532353885533,-2.098218818644183,-0.7907958987592221,12.571164119353218,22.134872945452344,-10.471030754315509,-11.284133981477295,25.495313420278116],\"outputs\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{\"nInputs\":16,\"nNeurons\":10,\"weights\":[33.81397738784729,20.917146219117804,21.24958258252306,41.76632545653806,-5.994682148207394,-4.4702335605404055,-5.651964422736274,-11.970770966588484,26.373028282627292,-39.27812442663615,1.1796468908445943,8.07980396298309,-9.02589358716647,-15.282481708668074,35.38938422742537,23.93947697651598,36.0492834414238,9.241921785991346,-25.467400440848266,17.334629558382453,-2.130215429136366,23.29014196805911,17.27625877576807,-17.621490965806053,38.07324942345703,-19.331997478897048,-38.586877268520304,-23.743956541938804,26.01337946586717,-28.239639994066806,-32.189452190351844,-12.885974225184638,36.87285430849394,-9.87973302168097,-37.34670551510657,23.169815550390595,-19.239196539942263,-15.613065152616763,30.555060500538012,-12.467186294781486,24.10057418705919,13.055633509144531,38.24604612629383,68.15233131655734,4.77394400181211,-10.23593925304443,0.6080934915788236,16.502376122241124,-74.11172419694411,4.98712533829679,-20.442842711399866,22.768485385270537,12.891067280611153,51.18195832079692,6.938669711076827,1.8218827411510292,21.266023711590634,20.257932946832433,-6.225128763378775,20.585332110042472,-5.572912430492868,8.491175111538137,-13.616526798086126,-38.5815522740451,15.923045735240853,40.08600471399391,57.15594480717821,28.973155853139033,65.92436793740963,-11.668178282046577,-37.76628832634593,-14.177556718499742,-6.2098906003499215,-39.339357152450425,3.3508520309633423,-23.87874602554206,7.623074752660623,3.7409169710013455,5.587360234389526,62.99806842789249,-10.280746640850639,41.70465516773069,-39.943809873218335,25.1621243797692,0.6414432485473812,-2.7939230222243676,32.49998677047093,-11.533139664214415,45.40126419269566,-59.57032709656479,7.115943623180776,9.117841427892037,-18.309707472035882,20.88575033700218,16.507025791730694,-40.94968753220478,1.3820678267936186,-34.6611022841698,-20.162052264590873,20.27463997354719,-13.666828890355054,-28.917780311836463,-56.33671141584161,9.350713033750512,-18.730353925930803,23.774552328652245,4.734207378615294,21.01206090535245,-40.004103056059634,-2.583604394918154,-17.279617529624232,38.92125714135124,34.94897555736304,-18.23695472149644,-0.5240794318974566,-27.24217792251523,-12.688465480346752,28.460033954955065,-1.8319155319218445,-22.349791888290696,-28.316781543132453,-25.61344313174298,42.643513566458985,21.19862448188201,18.675962309190275,-32.26738453028092,-14.437233874858052,11.661473181616937,-33.48495649374652,38.65990436179463,-20.16722561666795,-13.705530839989475,-41.6629735127761,-16.74001243985045,24.19262555479866,5.8450514237214595,-41.22935539836018,-32.40808306614034,-5.600508501581946,13.574504037505411,6.778672731814147,26.107483694563104,-24.91288833120685,-9.517254508214226,3.277532017218979,-15.110717701763312,-8.420334235811836,-22.304267102842488,-0.6678554301422741,0.36475553111670894,-43.951225733711716,-31.439639019689107,22.821676071866843,-10.777361725961548,35.61378652705114,-17.53065746046078,-19.31223602667013,13.911623222895148,-45.22759949950534,37.041346116227565,-12.110015601852897,-15.398225551321456,-3.022481231968011,3.927002715941293,10.642085869272574,2.320904844110944,-5.4332470733360845,-1.0859908076622178,-8.186459109054276,37.625687209959395],\"outputs\":[0,0,0,0,0,0,0,0,0,0]}]","evoParams":[]}
</textarea><br>
				<button class="button button1" onclick="onLoadNetworkButton()">Load network</button><br>
			</div>
		</div>
	</div>
</div>

<script>

const canvas = document.getElementById('canvas');
const canvasW = canvas.scrollWidth, canvasH = canvas.scrollHeight;

const mouse = captureMouse(canvas);
const mouseclick = captureMouseclick(canvas);

const pilotNet = makePilotNet();
// pilotNet.randomize();
// document.getElementById("ID_NET_SETUP").value = pilotNet.toText();
const g_pilot = new NeuralPilot( new Visualizer( new WorldModel(), pilotNet, 10, 10, 780 ), pilotNet );
onLoadNetworkButton();

let g_paused = false;
setPause(g_paused);

onRandomizePosButton();

let counter = 0;
window.onload = function() {
	const ctx = canvas.getContext('2d');
	ctx.fillStyle = "black";
	ctx.fillRect(0, 0, canvasW, canvasH);

	(function drawFrame () {
		counter += 1;

		window.requestAnimationFrame(drawFrame, canvas);
		ctx.clearRect(0, 0, canvasW, canvasH);
		// const t0 = performance.now();

		g_pilot.run(ctx, !g_paused);

		ctx.save();
		ctx.font = "10px sans-serif";
		ctx.textAlign = "left";
		ctx.strokeStyle = 'white';
		ctx.fillStyle = 'white';
		let ty = 25;
		for(let i = 0; i < pilotNet.inputs.length; ++i) {
			const txt = "in[" + i + "] " + pilotNet.inputs[i];
			ctx.fillText(txt, 20, ty);
			ty += 10;
		}
		ty = 25;
		const outVals = pilotNet.nnet._layers[pilotNet.nnet._layers.length - 1].outputs;
		for(let i = 0; i < outVals.length; ++i) {
			const txt = "out[" + i + "] " + outVals[i];
			ctx.fillText(txt, 200, ty);
			ty += 10;
		}
		ctx.restore();

		if(g_pilot.visualizer.model.pods.length == 0) {
			g_pilot.visualizer.drawExplosion(ctx, 5 + 5 * (Math.trunc(counter / 3) % 5));
			setPause(true);
		}

		// const t1 = performance.now();
		// console.log((t1 - t0) + " ms");
	}());
}

function onRandomizePosButton() {
	const pos = new Vec2();
	pos.randomInUnitDisk().multiplyScalar( 500 );
	const vel = new Vec2();
	vel.randomInUnitDisk().multiplyScalar( 5 );
	g_pilot.visualizer.model.rocket.reset(pos, vel);

	g_pilot.visualizer.model.pods = [];
	/*
	for(x = -2; x < 3; ++x) {
		for(y = -2; y < 3; ++y) {
			if(x == 0 || y == 0)
				continue;
			g_pilot.visualizer.model.pods.push( new Vec2().randomInUnitDisk().multiplyScalar( 25 ).addComponents( x * 100, y * 100 ) );
		}
	}
	*/
	g_pilot.visualizer.model.pods.push( new Vec2().randomInUnitDisk().normalize().multiplyScalar( 200 + Math.random() * 200 ) );

	setPause(false);
}

function onSetPosButton() {
	const x = parseFloat(document.getElementById("ID_POS_X").value);
	const y = parseFloat(document.getElementById("ID_POS_Y").value);
	const pos = new Vec2(x, y);
	const vel = new Vec2();
	g_pilot.visualizer.model.rocket.reset(pos, vel);
}

function onLoadNetworkButton() {
	g_pilot.pilotNet.fromText(document.getElementById("ID_NET_SETUP").value);
}

function onPauseButton() {
	setPause(!g_paused);
}

function setPause(doPause) {
	g_paused = doPause;
	document.getElementById("PAUSE_STATUS").innerHTML = "Pause " + (g_paused ? "ON" : "OFF");
}

</script>

</body>
</html>
